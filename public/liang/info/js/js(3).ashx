(function(){var o,l=6,n="",m=$("#pagination"),r;var q=5000;function d(s){if(s!=""){$.ajax({type:"GET",cache:false,dataType:"jsonp",jsonp:"callback",url:s,beforeSend:function(){},success:function(u){if(u!=""){pdata=u;$("#PartUser").html(u.UserName)}},error:function(){}})}}function a(x,v){v=v>0&&v<=20?v:2;x=parseFloat((x+"").replace(/[^\d\.-]/g,"")).toFixed(v)+"";var u=x.split(".")[0].split("").reverse(),w=x.split(".")[1];t="";for(i=0;i<u.length;i++){t+=u[i]+((i+1)%3==0&&(i+1)!=u.length?",":"")}return t.split("").reverse().join("")+"."+w}function c(y){var s=$("#Level").val();var u=$("#LevelMoney01").val();var w=$("#LevelSum").val();var v=$("#LevelShunyan1").val();var z="";var x=$("#LevelTotalSum").val();$.ajax({type:"GET",cache:false,dataType:"jsonp",jsonp:"callback",url:y,beforeSend:function(){},success:function(E){if(E!=""){var B=parseFloat(x)+parseFloat(E.OrderLevelSum);var A=parseFloat(w)+parseFloat(E.OrderLevelSum);$("#totalPrice").html(a(B,2));$("#totalLevelPrice").html(a(A,2));switch(s){case 0:if(parseFloat(E.OrderLevelSum)>0){var C=parseFloat(u)-parseFloat(w)-parseFloat(E.OrderLevelSum);C=C<0?0:C;$("#NextNeedSum").html(a(C,2))}break;case 1:z="您的VIP会员资格将在"+$("#EndTime").val()+"到期后顺延一年至"+$("#EndTime2").val();if(parseFloat(E.OrderLevelSum)>0){var C=parseFloat(u)-parseFloat(w)-parseFloat(E.OrderLevelSum);var D=parseFloat(v)-parseFloat(w)-parseFloat(E.OrderLevelSum);C=C<0?0:C;D=D<0?0:D;$("#NextNeedSum").html(a(C,2));if(D>0){$("#ShunyanNeedSum").html(a(D,2))}else{$("#shunyan").html(z)}}break;case 2:z="您的SVIP会员资格将在"+$("#EndTime").val()+"到期后顺延一年至"+$("#EndTime2").val();u=$("#LevelMoney12").val();v=$("#LevelShunyan2").val();if(parseFloat(E.OrderLevelSum)>0){var D=parseFloat(v)-parseFloat(w)-parseFloat(E.OrderLevelSum);D=D<0?0:D;if(D>0){$("#ShunyanNeedSum").html(a(D,2))}else{$("#shunyan").html(z)}}break;default:break}}},error:function(){}})}function e(s){var u="/Boot/_IsNickNameExist";$.ajax({type:"GET",cache:false,data:"nickName="+s,dataType:"html",async:false,url:u,beforeSend:function(){},success:function(v){if(v==true){p(j.existName)}else{h(s)}}});return false}function h(s){var u="/Boot/_ModifyNickName";$.ajax({type:"GET",cache:false,data:"nickName="+encodeURIComponent(s),async:false,dataType:"html",url:u,beforeSend:function(){},success:function(v){if(v=="0"){p(j.needNameDefeat);return false}else{if(v=="2"){p(j.existName);return false}else{if(v=="3"){p(j.needNameError);return false}else{if(v==="4"){p(j.existName);return false}else{$("#bNickName").html(v);$("#nikcname").val("");g.hide();f.show();return false}}}}},error:function(v,w){p(j.needNameError);return false}})}function b(){var s="/Boot/_GetCurrentNickName";$.ajax({type:"GET",cache:false,dataType:"html",url:s,beforeSend:function(){},success:function(u){$("#bNickName").html(u);$("#modifyname").hide()}})}function p(s){$("#nickname-icon").remove();$("#tip").parent().prepend('<span id="nickname-icon"></span>');$("#tip").html(s);$(".error-tip").css({visibility:"visible"});$("#nickname")[0].focus()}var j={needName:"请输入昵称！",existName:"昵称太受欢迎，有人抢了！",needNameError:"请输入2~16位中英文、数字、下划线",needNameDefeat:"对不起，昵称修改失败！",nameError:"对不起，昵称包含不合法文字！"};var k=$(".nickname-panel"),g=$("#modifyname"),f=k.children(".member-info");$(function(){$(".my_pic div").hover(function(){$(this).find("span.head_pic").show()},function(){$(this).find("span.head_pic").hide()});$(".member-info>#member").hover(function(){$(this).children("div").show();$(this).children("a").toggleClass("selected",true)},function(){$(this).children("div").hide();$(this).children("a").removeClass("selected")});$("#normal").mouseover(function(){$(this).css("background","url(http://i.vanclimg.com/my/2012/boot/biankuang.jpg) top left no-repeat")}).mouseout(function(){$(this).css("background","none")});GetRemmendListNew();var s=$(".nickname-panel>.vjia").data("partner");if(s!=="False"){var u=$("#partUserUrl").val();d(u);u+="&type=OC";c(u)}k.find(".member-info>#modify").click(function(){$("#nickname-icon").remove();var v=$("#bNickName").html();$("#nickname").val($.trim(v));$("#tip").html("中英文均可，2~16个字符");g.show();$(this).parent().hide();$("#nickname")[0].focus();return false});$("#aConfirm").click(function(){var v=$.trim($("#nickname").val());if(v===""){p(j.needName)}else{h(v)}return false});$("#nameCancle").click(function(){$("#nickname-icon").remove();$("#tip").html("中英文均可，2~16个字符");g.hide();f.show();return false})})})();var RemmendList,PageSize=10,productlist="",pagination=$("#pagination"),timerId,pageInfo=$("#page-info"),pageCount=0;var TickSpace=5000;var ItemRows=60;function GetProductByBrowseThenPurchase(a,b){GetRecommandProduct(a,0,1,b)}function GetProductByBrowseThenBrowse(a,b){GetRecommandProduct(a,0,1,b)}function GetProductByPurchaseThenPurchase(a,d,b,c){GetRecommandProduct(a,d,b,c)}function GetRecommandProduct(a,c,d,b){$.ajax({async:false,url:"http://recom-s.vancl.com/Product/GetCurrentRecommendProducts",type:"GET",dataType:"jsonp",jsonp:"callback",data:null,timeout:5000,cache:false,contentType:"application/json;utf-8",success:function(e){if(e!=null&&e!=undefined&&e.length>0){var j=e.length>10?10:e.length;var h=[];for(var g=0;g<j;g++){h[g]={MarketPrice:e[g].SPrice+".00",Price:e[g].SPrice+".00",ProductCode:e[g].ProductCode,ProductName:e[g].ProductName,ProductUrl:e[g].ItemUrl,SmallImage:e[g].Photos[0].FileName,Ref:"r-my-odr-"+g}}var f={Message:"调用成功",Success:true,Title:"为我推荐",Items:h};$("[fid=titname]").text(f.Title);if($("#recommandtype").val()!="order"){if($("#product-code-list").val()==""){$("[fid=titname]").text("为您推荐")}}if($("#recommandtype").val()=="order"){if($("#product-code-list").val()==""){$("[fid=titname]").text("为您推荐")}else{$("[fid=titname]").text("购买相同商品的顾客还购买了：")}}RemmendList=f;InitRecommendList()}},error:function(f,g,e){alert(g)}})}function RecommendListLi(c){var a=c*PageSize;var b=a+PageSize;if(RemmendList.Success){pageInfo.children("label").text(pagination.data("current_page")+1);var d="";$("#recommendlist").fadeOut(500,function(){var e=new Array(6);e[0]="first";e[1]="second";e[2]="third";e[3]="fourth";e[4]="fifth";e[5]="sixth";e[6]="seven";e[7]="eight";e[8]="nine";e[9]="ten";$.each(RemmendList.Items,function(f,j){if(f>=a&&f<b){var n=j.ProductName;var k=n.getBytesLength();if(k>42){n=n.intercept(42)+"..."}j.ProductUrl="http://item.vancl.com/"+j.ProductCode.toString()+".html";var m=j.ProductCode;var o=j.ref;var l="my-recommend-"+e[f%10]+"-producname";var h="my-recommend-"+e[f%10]+"-productpicture";var g="http://p1.vanclimg.com/130/product/"+m.substring(0,1)+"/"+m.substring(1,2)+"/"+m.substring(2,3)+"/"+m+"/big/"+j.SmallImage;d+="<li><p class='pic'><a href='"+j.ProductUrl+"' rel = '"+o+"' class='track' name='"+h+"' target='_blank' title='"+j.ProductName+"'><img src='"+g+"' width='130' height='130' /></a></p>";d+="<p class='prod_name'><a href='"+j.ProductUrl+"' rel = '"+o+"'  class='track' name='"+l+"' target='_blank' title='"+j.ProductName+"'>"+n+"</a></p> ";d+="<p class='s_price'>市场价：￥<span>"+j.MarketPrice+"</span></p><p class='price'>售价：￥"+j.Price+"</p></li>"}productlist+=j.ProductCode+","});$("#recommendlist").html(d);$("#recommendlist").fadeIn(500)});$("#pagination").find(".prev").attr("class","prev track").attr("name","my-recommend-previous page");$("#pagination").find(".next").attr("class","next track").attr("name","my-recommend-next page");return false}}function setTimer(c,d,b){var a=arguments;timerId=setTimeout(function(){b=b||[];c.apply(this,b);a.callee(c,d,b)},d)}function autoClick(){if(parseInt(pageCount)&&pageCount<2){return}var a=pagination.find(".next"),b=pagination.find(".prev");if(a.data("page_id")===pagination.data("current_page")){b.data("page_id",0);b.click()}else{a.click()}}function InitRecommendList(){var b=RecommendListLi(0);var a=RemmendList.Items.length;pageCount=Math.ceil(a/PageSize);pagination.pagination(a,{callback:RecommendListLi,num_display_entries:0,items_per_page:PageSize,prev_text:" ",next_text:" "});$("#pagination").find(".prev").attr("class","prev track").attr("name","my-recommend-previous page");$("#pagination").find(".next").attr("class","next track").attr("name","my-recommend-next page");pageInfo.children("span").text("/"+pageCount);pageInfo.children("label").text(1);$(".tj1").hover(function(){if(timerId){clearTimeout(timerId)}},function(){setTimer(autoClick,TickSpace)});RecommendSuitList(b)}function GetRemmendListNew(){var a="/Boot/_NewProduct";$.ajax({type:"GET",cache:false,dataType:"text",url:a,beforeSend:function(){},success:function(b){if(b!=""){RecommendSuitList(b)}},error:function(b){}})}function GetRemmendList(b,d,e,c,a){if(a=="LookAndBuy"){GetProductByBrowseThenPurchase(b,d)}else{if(a=="LookAndLook"){GetProductByBrowseThenBrowse(b,d)}else{if(a=="BuyAndBuy"){GetProductByPurchaseThenPurchase(b,e,c,d)}}}}function RecommendSuitList(a){if(window.location.href.toLowerCase().indexOf("order")>=0){return}var b="/Boot/_Jifenhuangou";$.ajax({type:"GET",cache:false,data:"ram="+Math.random(),dataType:"text",url:b,beforeSend:function(){},success:function(c){if(c!=""){strResult=c;$("#recommendsuit").html(strResult)}}})}function getLen(a){return a.replace(/[^\x00-\xff]/g,"xx").length}String.prototype.removeCharAt=function(a){var b=this;if(a<=this.length){if(a===0){b=this.substring(1)}else{if(a==this.length-1){b=this.substring(0,this.length-1)}else{b=this.substring(0,a)+this.substring(a+1)}}}return b};String.prototype.intercept=function(b){var c=this;var a=c.getBytesLength();while(a>b){c=c.removeCharAt(c.length-1);a=c.getBytesLength()}return c};String.prototype.getBytesLength=function(){return this.length+(escape(this).split("%u").length-1)};document.domain="vancl.com";$(function(){var a=$('<div id="imdiv"><img hspace="6" src="http://i.vanclimg.com/others/2011/11/9/icon.gif" align="absmiddle" /><a style="padding-right:8px;" href="http://imweb.vancl.com" id="impage" target="_blank">在线客服</a><a href="#"><img src="http://i.vanclimg.com/others/2011/11/9/top.gif" hspace="3" align="absmiddle" /></a></div>').attr("style","width:112px; height:25px; padding-top:3px;float:right; background:url(http://i.vanclimg.com/others/2011/11/9/bg.gif) center no-repeat; position:fixed;_position:absolute;_bottom:auto; right:0; bottom:0;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)))");$("body").append(a);$("#im").live("click",function(){$(this).prev("img").attr("http://i.vanclimg.com/others/2011/11/9/icon.gif");var b=$("#imiframe");if(b.length==0){b=$("<iframe />");b.attr("id","imiframe").attr("src",$(this).attr("href")).attr("frameborder","0").attr("scrolling","no").css({width:641,height:480,bottom:0,right:0,position:"fixed","z-index":9999}).attr("style","width:641px; height:480px;z-index:9999;position:fixed; _position:absolute;_bottom:auto; right:0; bottom:0;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)))").appendTo("body")}b.show();return false});window.hidePanel=function(){$("#im").prev("img").attr("src","http://i.vanclimg.com/others/2011/11/9/icon.gif");$("#imiframe").hide()};window.closePanel=function(){$("#im").prev("img").attr("src","http://i.vanclimg.com/others/2011/11/9/icon.gif");$("#imiframe").remove()};window.toTop=function(){window.scrollTo(0,0)};window.notifyNewMessage=function(){$("#im").prev("img").attr("src","http://i.vanclimg.com/others/2011/11/9/gif.gif")}});