<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>today-list门店列表</title>
	<link rel="stylesheet" type="text/css" href="__LOCAL__/css/today-list.css">
	<link rel="stylesheet" type="text/css" href="__LOCAL__/css/food-gl.css">
	<link rel="stylesheet" type="text/css" href="__LOCAL__/css/bootstrap.min.css">
</head>
<body>
<div class="today-title">
	<div class="title-1"><h3>门店管理</h3></div>
	<div class="title-1"><h5 style="line-height: 50px;">门店：{$shopinfo.f_shopname}</h5></div>
</div>
<div class="today-search">
	<ul>
		<li id="xz-blue"><a href="{:url('Dishes/index?shopid='.$shopid)}">菜肴管理</a></li>
		<li><a href="{:url('Shop/getDineshopSell?shopid='.$shopid)}">放号管理</a></li>
		<li><a href="{:url('Shop/getDineshopDiscount?shopid='.$shopid)}">折扣管理</a></li>
		<li><a href="{:url('Shop/getDesklist?shopid='.$shopid)}">桌号管理</a></li>
	</ul>
	<div class="title-2"><div><a href="{:url('addDishes?shopid='.$shopid)}">新增</a></div></div>
	<div class="title-2"><div><a href="{:url('classify/index?shopid='.$shopid)}">菜肴分类管理</a></div></div>
</div>
<div class="today-table">
	<table class="table table-bordered" id="tablePage" style="float:left;">
		<tr id="table-title">
			<td>序号</td>
			<td>菜肴图片</td>
			<td>菜肴名称</td>
			<td>一级分类</td>
			<td>二级分类</td>
			<td>口味种类</td>
			<td>描述</td>
			<td>店铺描述</td>
			<td>价格</td>
			<td>默认折扣</td>
			<td>菜肴状态</td>
			<td>操作</td>
		</tr>
		{volist name="list" id="vo"}
			<tr>
				<td>{$vo.id}</td>
				<td><img src="{$vo.dishicon}" width="30px" height="30px"></td>
				<td>{$vo.dishname}</td>
				<!-- <td>{volist name="list1" id="info"}{eq name="info.f_cid" value="vo.cuisineid"}{$info.f_cname}{/eq}{/volist}</td>
				<td>{volist name="list2" id="info"}{eq name="info.f_cid" value="vo.classid"}{$info.f_cname}{/eq}{/volist}</td> -->
				<td><?php foreach ($list1 as $key => $val) {if($val['f_cid'] == $vo['cuisineid']){ echo $val['f_cname'];}}?></td>
				<td><?php foreach ($list2 as $key => $val) {if($val['f_cid'] == $vo['classid']){ echo $val['f_cname'];}}?></td>
				<td>{$vo.tastesid}</td>
				<td>{$vo.dishdesc}</td>
				<td>{$vo.shopname}</td>
				<td>￥{$vo.dishprice}</td>
				<td><a href="">{$vo.defdiscount}</td>
				<td>
					<select onchange="editStatus(this)" dishid="{$vo.id}">
						<option value="{$vo.status}">{$status[$vo.status]}</option>
						{volist name="status" id="v"}
						{if condition="$key != $vo.status && $key != 0 && $key != 1 && $key != -100 "}
						<option value="{$key}">{$v}</option>
						{/if}
						{/volist}
					</select>
				</td>
				<td><a href="{:url('editDish?dishid='.$vo.id.'&shopid='.$shopid)}">修改</a>&nbsp;<a href="javascript:void(0)" class="del" dishid="{$vo.id}">删除</a></td>
			</tr>
		{/volist}
	</table>
</div>
<div class="today-page">
	<div class="pagination pagination-large">
	<div id="number"><input id="countnum" min="10" max="50" type="number" value="50" style="width:32px;height:35px;" onBlur="count()"></div>
	  <ul id="page">
	  	
	  </ul>
	<div id="number-show"><span>共180条。每页显示50条</span></div>
	</div>
</div>
<script type="text/javascript" src="__LOCAL__/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="__LOCAL__/js/jquery-2.0.2.min.js"></script>
<script type="text/javascript" src="__LOCAL__/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__LOCAL__/js/table-page.js"></script>
</body>
<script>
	$(".del").click(function(){
		url = "{:url('delDish')}";
		dishid = $(this).attr('dishid');
		if(confirm("您确定要删除该菜肴吗？")){
			$.post(url,{dishid:dishid},function(data){
				if(data.code == -1){
					alert(data.msg);
				}else{
					alert("删除成功");
					window.location.href = "{:url('index?shopid='.$shopid)}";
				}
			});
		}
		
	})
	function editStatus(o){
		status = $(o).val();
		id = $(o).attr('dishid');
		// alert(status);
		// alert(id);
		$.ajax({
			type:'POST',
			url:"{:url('modDishestatus')}",
			data:"id="+id+"&status="+status,
			success:function(data){
				if(data == 1){
					alert('修改成功');
				}else{
					alert('修改失败');
				}
			}
		});
	}
</script>
</html>